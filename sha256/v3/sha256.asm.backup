.section .rodata
k:
	.word 0x428a2f98, 0x71374491, 0xb5c0fbcf, 0xe9b5dba5, 0x3956c25b, 0x59f111f1, 0x923f82a4, 0xab1c5ed5
	.word 0xd807aa98, 0x12835b01, 0x243185be, 0x550c7dc3, 0x72be5d74, 0x80deb1fe, 0x9bdc06a7, 0xc19bf174
	.word 0xe49b69c1, 0xefbe4786, 0x0fc19dc6, 0x240ca1cc, 0x2de92c6f, 0x4a7484aa, 0x5cb0a9dc, 0x76f988da
	.word 0x983e5152, 0xa831c66d, 0xb00327c8, 0xbf597fc7, 0xc6e00bf3, 0xd5a79147, 0x06ca6351, 0x14292967
	.word 0x27b70a85, 0x2e1b2138, 0x4d2c6dfc, 0x53380d13, 0x650a7354, 0x766a0abb, 0x81c2c92e, 0x92722c85
	.word 0xa2bfe8a1, 0xa81a664b, 0xc24b8b70, 0xc76c51a3, 0xd192e819, 0xd6990624, 0xf40e3585, 0x106aa070
	.word 0x19a4c116, 0x1e376c08, 0x2748774c, 0x34b0bcb5, 0x391c0cb3, 0x4ed8aa4a, 0x5b9cca4f, 0x682e6ff3
	.word 0x748f82ee, 0x78a5636f, 0x84c87814, 0x8cc70208, 0x90befffa, 0xa4506ceb, 0xbef9a3f7, 0xc67178f2

.text
.globl sha256_transform
sha256_transform:
	addi  sp, sp, -336
	sd	  s0, 328(sp)
	sd	  s1, 320(sp)
	sd	  s2, 312(sp)
	sd	  s3, 304(sp)
	sd	  s4, 296(sp)
	sd	  s5, 288(sp)
	sd	  s6, 280(sp)
	sd	  s7, 272(sp)
	sd	  s8, 264(sp)

    mv	  a2, a1
	addi  a3, sp, 8
	addi  a4, sp, 72
.sha256_transform_loop_1:
	ld	  a5, 0(a2)                       # Load 8 bytes (64-bit)
	rev8  a5, a5                          # Reverse all 8 bytes
	sw	  a5, 4(a3)                       # Store lower 32 bits (originally bytes 4-7)
	srli  a5, a5, 32                      # Shift to get upper 32 bits
	sw	  a5, 0(a3)                       # Store upper 32 bits (originally bytes 0-3)
	addi  a2, a2, 8
    addi  a3, a3, 8
	bne	  a3, a4, .sha256_transform_loop_1

    addi  a2, sp, 72
	addi  a3, sp, 264
    lw    a4, 8(sp)                       # Store m[i-16] as a variable for this and next loop
.sha256_transform_loop_2:
	lw    a5, -8(a2)                      # s := SIG1(m[i - 2])
    roriw s0, a5, 17
	roriw s1, a5, 19
    xor   s0, s0, s1
    srliw a5, a5, 10
	xor	  a5, a5, s0
	lw	  a6, -28(a2)                     # s += m[i-7]
    add   a5, a5, a6
	add	  a5, a5, a4                      # s += m[i-16]
	lwu	  a4, -60(a2)                     # s += SIG0(m[i-15])
	roriw s0, a4, 7
	roriw s1, a4, 18
	xor	  s0, s0, s1
	srliw a6, a4, 3
	xor	  a6, a6, s0
	add	  a5, a5, a6
	sw	  a5, 0(a2)                       # m[i] = s
	addi  a2, a2, 4
	bne	  a2, a3, .sha256_transform_loop_2

# %bb.4:
	lw	t5, 80(a0)
	lw	t4, 84(a0)
	lw	t3, 88(a0)
	lw	t2, 92(a0)
	lw	t1, 96(a0)
	lw	t0, 100(a0)
	lw	a7, 104(a0)
	lw	a6, 108(a0)
	lui	a4, %hi(k)
	addi	a4, a4, %lo(k)
	addi	a5, sp, 8
	addi	t6, a4, 256
	mv	s7, t5
	mv	a1, t4
	mv	s5, a6
	mv	a3, a7
	mv	a2, t0
	mv	s8, t1
	mv	s4, t2
	mv	s1, t3
.LBB0_5:                                # =>This Inner Loop Header: Depth=1
	mv	s6, s1
	mv	s0, s8
	mv	s3, a2
	mv	s2, a3
	mv	s1, a1
	mv	a1, s7
	roriw	a2, s8, 6
	roriw	a3, s8, 11
	xor	a2, a2, a3
	roriw	a3, s8, 25
	xor	s7, a2, a3
	and	a3, s3, s8
	andn	a2, s2, s8
	or	s8, a2, a3
	lw	a3, 0(a4)
	lw	a2, 0(a5)
	add	s5, s5, s8
	add	s5, s5, s7
	add	a3, a3, s5
	add	a2, a2, a3
	roriw	s5, a1, 2
	roriw	a3, a1, 13
	xor	s5, s5, a3
	roriw	a3, a1, 22
	xor	s5, s5, a3
	xor	a3, s1, s6
	and	s7, a1, a3
	and	a3, s1, s6
	xor	a3, s7, a3
	add	a3, a3, s5
	add	s8, a2, s4
	add	s7, a3, a2
	addi	a4, a4, 4
	addi	a5, a5, 4
	mv	s5, s2
	mv	a3, s3
	mv	a2, s0
	mv	s4, s6
	bne	a4, t6, .LBB0_5
# %bb.6:
	add	t5, t5, s7
	sw	t5, 80(a0)
	add	a1, a1, t4
	sw	a1, 84(a0)
	add	t3, t3, s1
	sw	t3, 88(a0)
	add	t2, t2, s6
	sw	t2, 92(a0)
	add	t1, t1, s8
	sw	t1, 96(a0)
	add	t0, t0, s0
	sw	t0, 100(a0)
	add	a7, a7, s3
	sw	a7, 104(a0)
	add	a6, a6, s2
	sw	a6, 108(a0)
	ld	s0, 328(sp)                     # 8-byte Folded Reload
	ld	s1, 320(sp)                     # 8-byte Folded Reload
	ld	s2, 312(sp)                     # 8-byte Folded Reload
	ld	s3, 304(sp)                     # 8-byte Folded Reload
	ld	s4, 296(sp)                     # 8-byte Folded Reload
	ld	s5, 288(sp)                     # 8-byte Folded Reload
	ld	s6, 280(sp)                     # 8-byte Folded Reload
	ld	s7, 272(sp)                     # 8-byte Folded Reload
	ld	s8, 264(sp)                     # 8-byte Folded Reload
	addi	sp, sp, 336
	ret
.Lfunc_end0:
	.size	sha256_transform, .Lfunc_end0-sha256_transform
                                        # -- End function


.section .rodata
.sha256_init_data:
	.quad 0xbb67ae856a09e667
	.quad 0xa54ff53a3c6ef372
	.quad 0x9b05688c510e527f
	.quad 0x5be0cd191f83d9ab
.text
.globl sha256_init
sha256_init:
	sw  zero, 64(a0)
	sd  zero, 72(a0)
	la  a1, .sha256_init_data
	ld  a2, 0(a1)
	sd  a2, 80(a0)
	ld  a2, 8(a1)
	sd  a2, 88(a0)
	ld  a2, 16(a1)
	sd  a2, 96(a0)
	ld  a2, 24(a1)
	sd  a2, 104(a0)
	ret


	.globl	sha256_update                   # -- Begin function sha256_update
	.p2align	1
	.type	sha256_update,@function
sha256_update:                          # @sha256_update
# %bb.0:
	beqz	a2, .LBB2_6
# %bb.1:
	addi	sp, sp, -48
	sd	ra, 40(sp)                      # 8-byte Folded Spill
	sd	s0, 32(sp)                      # 8-byte Folded Spill
	sd	s1, 24(sp)                      # 8-byte Folded Spill
	sd	s2, 16(sp)                      # 8-byte Folded Spill
	sd	s3, 8(sp)                       # 8-byte Folded Spill
	sd	s4, 0(sp)                       # 8-byte Folded Spill
	mv	s3, a2
	mv	s2, a1
	mv	s1, a0
	lw	a0, 64(a0)
	li	a1, 0
	li	s0, 1
	li	s4, 64
	j	.LBB2_3
.LBB2_2:                                #   in Loop: Header=BB2_3 Depth=1
	zext.w	a1, s0
	addi	s0, s0, 1
	bgeu	a1, s3, .LBB2_5
.LBB2_3:                                # =>This Inner Loop Header: Depth=1
	add	a1, a1, s2
	lbu	a1, 0(a1)
	add.uw	a0, a0, s1
	sb	a1, 0(a0)
	lw	a0, 64(s1)
	addiw	a0, a0, 1
	sw	a0, 64(s1)
	bne	a0, s4, .LBB2_2
# %bb.4:                                #   in Loop: Header=BB2_3 Depth=1
	mv	a0, s1
	mv	a1, s1
	call	sha256_transform
	ld	a1, 72(s1)
	li	a0, 0
	addi	a1, a1, 512
	sd	a1, 72(s1)
	sw	zero, 64(s1)
	j	.LBB2_2
.LBB2_5:
	ld	ra, 40(sp)                      # 8-byte Folded Reload
	ld	s0, 32(sp)                      # 8-byte Folded Reload
	ld	s1, 24(sp)                      # 8-byte Folded Reload
	ld	s2, 16(sp)                      # 8-byte Folded Reload
	ld	s3, 8(sp)                       # 8-byte Folded Reload
	ld	s4, 0(sp)                       # 8-byte Folded Reload
	addi	sp, sp, 48
.LBB2_6:
	ret
.Lfunc_end2:
	.size	sha256_update, .Lfunc_end2-sha256_update
                                        # -- End function
	.globl	sha256_final                    # -- Begin function sha256_final
	.p2align	1
	.type	sha256_final,@function
sha256_final:                           # @sha256_final
# %bb.0:
	addi	sp, sp, -32
	sd	ra, 24(sp)                      # 8-byte Folded Spill
	sd	s0, 16(sp)                      # 8-byte Folded Spill
	sd	s1, 8(sp)                       # 8-byte Folded Spill
	mv	s0, a0
	lwu	a2, 64(a0)
	mv	s1, a1
	add	a0, a0, a2
	li	a3, 128
	li	a1, 55
	sb	a3, 0(a0)
	bltu	a1, a2, .LBB3_3
# %bb.1:
	beq	a2, a1, .LBB3_6
# %bb.2:
	addi	a0, a0, 1
	li	a1, 55
	subw	a2, a1, a2
	li	a1, 0
	call	memset
	j	.LBB3_6
.LBB3_3:
	addiw	a0, a2, 1
	li	a1, 63
	bltu	a1, a0, .LBB3_5
# %bb.4:
	add	a0, a0, s0
	li	a1, 62
	subw	a1, a1, a2
	addi	a2, a1, 1
	li	a1, 0
	call	memset
.LBB3_5:
	mv	a0, s0
	mv	a1, s0
	call	sha256_transform
	sd	zero, 48(s0)
	sd	zero, 40(s0)
	sd	zero, 32(s0)
	sd	zero, 24(s0)
	sd	zero, 16(s0)
	sd	zero, 8(s0)
	sd	zero, 0(s0)
.LBB3_6:
	lw	a0, 64(s0)
	ld	a1, 72(s0)
	slli	a0, a0, 3
	add.uw	a0, a0, a1
	sd	a0, 72(s0)
	sb	a0, 63(s0)
	srli	a1, a0, 8
	sb	a1, 62(s0)
	srli	a1, a0, 16
	sb	a1, 61(s0)
	srli	a1, a0, 24
	sb	a1, 60(s0)
	srli	a1, a0, 32
	sb	a1, 59(s0)
	srli	a1, a0, 40
	sb	a1, 58(s0)
	srli	a1, a0, 48
	sb	a1, 57(s0)
	srli	a0, a0, 56
	sb	a0, 56(s0)
	mv	a0, s0
	mv	a1, s0
	call	sha256_transform
	lbu	a0, 83(s0)
	sb	a0, 0(s1)
	lbu	a0, 87(s0)
	sb	a0, 4(s1)
	lbu	a0, 91(s0)
	sb	a0, 8(s1)
	lbu	a0, 95(s0)
	sb	a0, 12(s1)
	lbu	a0, 99(s0)
	sb	a0, 16(s1)
	lbu	a0, 103(s0)
	sb	a0, 20(s1)
	lbu	a0, 107(s0)
	sb	a0, 24(s1)
	lbu	a0, 111(s0)
	sb	a0, 28(s1)
	lbu	a0, 82(s0)
	sb	a0, 1(s1)
	lbu	a0, 86(s0)
	sb	a0, 5(s1)
	lbu	a0, 90(s0)
	sb	a0, 9(s1)
	lbu	a0, 94(s0)
	sb	a0, 13(s1)
	lbu	a0, 98(s0)
	sb	a0, 17(s1)
	lbu	a0, 102(s0)
	sb	a0, 21(s1)
	lbu	a0, 106(s0)
	sb	a0, 25(s1)
	lbu	a0, 110(s0)
	sb	a0, 29(s1)
	lbu	a0, 81(s0)
	sb	a0, 2(s1)
	lbu	a0, 85(s0)
	sb	a0, 6(s1)
	lbu	a0, 89(s0)
	sb	a0, 10(s1)
	lbu	a0, 93(s0)
	sb	a0, 14(s1)
	lbu	a0, 97(s0)
	sb	a0, 18(s1)
	lbu	a0, 101(s0)
	sb	a0, 22(s1)
	lbu	a0, 105(s0)
	sb	a0, 26(s1)
	lbu	a0, 109(s0)
	sb	a0, 30(s1)
	lbu	a0, 80(s0)
	sb	a0, 3(s1)
	lbu	a0, 84(s0)
	sb	a0, 7(s1)
	lbu	a0, 88(s0)
	sb	a0, 11(s1)
	lbu	a0, 92(s0)
	sb	a0, 15(s1)
	lbu	a0, 96(s0)
	sb	a0, 19(s1)
	lbu	a0, 100(s0)
	sb	a0, 23(s1)
	lbu	a0, 104(s0)
	sb	a0, 27(s1)
	lbu	a0, 108(s0)
	sb	a0, 31(s1)
	ld	ra, 24(sp)                      # 8-byte Folded Reload
	ld	s0, 16(sp)                      # 8-byte Folded Reload
	ld	s1, 8(sp)                       # 8-byte Folded Reload
	addi	sp, sp, 32
	ret
.Lfunc_end3:
	.size	sha256_final, .Lfunc_end3-sha256_final
                                        # -- End function
